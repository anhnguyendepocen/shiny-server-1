---
title: "DataSpice2.0"
author: "Erin M. Buchanan"
date: "9/18/2018"
output: html_document
runtime: shiny
---

```{r setup, echo = FALSE, warning = FALSE, message = FALSE}
library(shiny)
library(DT)
source("edit_df.R")
```

## DataSpice 2.0

List credits here, purpose, why you might use this thing. 

### Please upload your data file:

Talk here about the types of files accepted - at the moment it's just csv, txt, tsv

```{r data-upload, echo=FALSE}

inputPanel(
    fileInput('file1', 'Choose a file to upload:',
            accept = c(
              'text/csv',
              'text/comma-separated-values',
              'text/tab-separated-values',
              'text/plain',
              '.csv',
              '.tsv'
            ) #close accept
            ) #close file input
    ) #close input panel

rv <- reactiveValues(data = NULL)

observe({
  req(input$file1)

  inFile <- input$file1
  data2 <- read.csv(inFile$datapath, stringsAsFactors=FALSE)
  rv$data <- data2
  }) #close observe

DT::renderDataTable({
  req(rv$data)
  rv$data
  }) #close DT

```

```{r create-metadata, echo = FALSE}
#from the files we shall create the meta-data files that end up being saved
#this is a modification of create_spice()
#instead of copying over files, we will just create these files ad hoc

access_df <- data.frame(fileName = character(),
                     name = character(),
                     contentUrl = character(),
                     fileFormat = character(),
                     stringsAsFactors = F)

attributes_df <- data.frame(fileName = character(),
                            variableName = character(),
                            description = character(),
                            unitText = character(),
                            stringsAsFactors = F)

bibio_df <- data.frame(title = character(),
                       description = character(),
                       datePublished = character(),
                       citation = character(),
                       keywords = character(),
                       license = character(),
                       funder = character(),
                       geographicDescription = character(),
                       startDate = character(),
                       endDate = character(),
                       stringsAsFactors = F)

creators_df <- data.frame(id = character(),
                          givenName = character(),
                          familyName = character(),
                          affliation = character(),
                          email = character(),
                          stringsAsFactors = F)

```

```{r prep-attributes, eval = FALSE, echo = FALSE}
#now we are going to take the file they loaded and prepare it for the attributes editing

#deal with uploading wait
if (exists(user_data)) {
  attributes_df <- tibble::add_row(attributes_df,
                                 variableName = names(user_data))
} else ("Please upload a file to get started.")
```

```{r edit-attributes, eval = FALSE, echo = FALSE}

edit_file(what_edit = "attributes_df", 
          what_edit_type = "Attributes",
          what_df = attributes_df)
```


5) Runs prep access (our version)
6) App pulls up edit access
7) Edit the bib, figure out the spatial coverage thing
8) edit creators (fix issue)
9) write spice to do the json
10) build site to build the html (maybe restructure this)


## Inputs and Outputs

You can embed Shiny inputs and outputs in your document. Outputs are automatically updated whenever inputs change.  This demonstrates how a standard R plot can be made interactive by wrapping it in the Shiny `renderPlot` function. The `selectInput` and `sliderInput` functions create the input widgets used to drive the plot.

```{r eruptions, echo=FALSE}
inputPanel(
  selectInput("n_breaks", label = "Number of bins:",
              choices = c(10, 20, 35, 50), selected = 20),
  
  sliderInput("bw_adjust", label = "Bandwidth adjustment:",
              min = 0.2, max = 2, value = 1, step = 0.2)
)

renderPlot({
  hist(faithful$eruptions, probability = TRUE, breaks = as.numeric(input$n_breaks),
       xlab = "Duration (minutes)", main = "Geyser eruption duration")
  
  dens <- density(faithful$eruptions, adjust = input$bw_adjust)
  lines(dens, col = "blue")
})
```